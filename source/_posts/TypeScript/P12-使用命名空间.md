---
title: P12 使用命名空间
tags:
  - null
categories:
  - TypeScript
hidden: false
date: 2022-02-25 20:29:34
abbrlink:
---

# 使用命名空间

> 命名空间能有效的防止全局污染。在 `ES6` 中引入模块化后，不用再考虑全局污染的问题了，所以命名空间很少再使用。

> 但是当你使用了一些全局类库，命名空间依然是一个比较好的解决方案！

## 定义

在 `a.ts` 文件中：

``` typescript
namespace Shap {
    const pi = Math.PI
    export function cricle (r: number) {
        return pi * r ** 2
    }
    export function area (w: number, h: number) {
        return w * h
    }
}
```

在这个命名空间内可以定义任意多个变量，这些变量只能在这个 `Shap` 命名空间下可见，如果想让其变量在全局内可见的话，需要使用 `export` 关键字将其导出。

当我们的程序越来越大时，这个命名空间会不断扩大。但是这个命名空间也是可以进行拆分的。比如在 `b.ts` 中：

``` typescript
namespace Shape {
    export function square (x: number) {
        return x ** 2
    }
}
```

可以看出，`a.ts` & `b.ts` 中不同的文件下使用了同一个命名空间 `Shape` 。它们是**共享同一个命名空间**的。

## 使用

使用也是很简单的，在 `b.ts` 下编写代码：

``` typescript
...
Shape.area(3, 5) // a.ts 文件下的方法
Shape.square(3)
```

> 注意：命名空间不要与模块混用，不要在一个模块中使用命名空间。命名空间最好在一个全局的环境中使用。

正确的使用方法是：将 `a.ts` & `b.ts` 文件编译成 `.js` 文件，之后在 `index.ts` 中通过 `<script></script>` 标签引入。

通过使用 `tsc` 命令把 `.ts` 文件转为 `.js` 文件，命令是：`tsc ./src/b.ts`。

这时能看到提示报错，说：

``` javascript
src/b.ts:12:7 - error TS2339: Property 'area' does not exist on type 'typeof Shape'.

12 Shape.area(3, 5)
		 ~~~~


Found 1 error.
```

通过提示能得知是 `Shape.area` 方法并不在 `b.ts` 文件内，虽然 `a.ts` 与 `b.ts` 中的 `Shape` 共享命名空间。

所以需要我们在 `b.ts` 文件内引入 `a.ts` 文件。`b.ts` 中代码如下：

``` typescript
// path="xxx" 采用的是相对路径
/// <reference path="a.ts" />
...
```

被编译后的 `a.js` 中的代码如下：

``` javascript
var Shape;
(function (Shape) {
    var pi = Math.PI;
    function cricle(r) {
        return pi * Math.pow(r, 2);
    }
    Shape.cricle = cricle;
    function area(w, h) {
        return w * h;
    }
    Shape.area = area;
})(Shape || (Shape = {}));
```

被编译后的 `b.js` 中代码如下：

``` javascript
/// <reference path="a.ts" />
var Shape;
(function (Shape) {
    function square(x) {
        return Math.pow(x, 2);
    }
    Shape.square = square;
})(Shape || (Shape = {}));
Shape.area(3, 5);
Shape.square(3);
```

解读：
命名空间被编译成了一个立即执行函数，这个函数创建了一个闭包，在这个闭包之内，有一些私有类成员，例如 `pi` 变量，导出的成员会被挂载在变量 `Shape` 上。

## 命名空间别名

为了方便直接访问命名空间下的变量 / 函数，可以通过使用别名来直接访问。在 `b.ts` 中代码如下：

``` typescript
import cricle = Shape.cricle
console.log(cricle(3));
```

## 总结

在如今的 `ES6` 的模块下，是没有必要使用命名空间的。而 `typescript` 保留命名空间的考虑是为了兼容之前的版本下的全局变量。