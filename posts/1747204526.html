<!DOCTYPE html><html lang="zh-CN"><head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="BLJJ-DBLD">


    <meta name="subtitle" content="å¾®ä»»åŠ¡">




<title>å¯¹ Vue2.x å’Œ Vue3.x çš„ç›‘å¬å®ç°ä¸ç†è§£ | BLJJ-DBLD Blog</title>



    <link rel="icon" href="https://cdn.reorz.com/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    
    
    
    



    <!-- scripts list from _config.yml -->
    
    
    
    
    
    
    
    <script src="https://cdn.jsdelivr.net/npm/lightgallery.js@1.1.3/dist/js/lightgallery.min.js"></script>
    
    
    



<!-- Global site tag (gtag.js) - Google Analytics -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-SSN1WL65KY"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-SSN1WL65KY');
</script>

<meta name="generator" content="Hexo 5.4.0"><script>function loadCss(l){var d=document,h=d.head,s=d.createElement('link');s.rel='stylesheet';s.href=l;!function e(f){if (d.body)return f();setTimeout(function(){e(f)})}(function(){h.appendChild(s);});}loadCss('/style.css');loadCss('https://cdn.jsdelivr.net/npm/lightgallery.js@1.1.3/dist/css/lightgallery.min.css');</script><noscript><link rel="stylesheet" href="/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery.js@1.1.3/dist/css/lightgallery.min.css"></noscript></head>

<body>
    

    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">&lt; BLJJ-DBLD blog /&gt;</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">å½’æ¡£</a>
                
                    <a class="menu-item" href="/categories">åˆ†ç±»</a>
                
                    <a class="menu-item" href="/tags">æ ‡ç­¾</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">&lt; BLJJ-DBLD blog /&gt;</a><a id="mobile-toggle-theme">Â·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">â˜° Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">å½’æ¡£</a>
                
                    <a class="menu-item" href="/categories">åˆ†ç±»</a>
                
                    <a class="menu-item" href="/tags">æ ‡ç­¾</a>
                
            </div>
        </div>
    </nav>

</header>

            <div class="main">
                <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>


    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">å¯¹ Vue2.x å’Œ Vue3.x çš„ç›‘å¬å®ç°ä¸ç†è§£</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">BLJJ-DBLD</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">ä¸€æœˆ 13, 2022&nbsp;&nbsp;13:51:28</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/categories/Vue/">Vue</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <p>åœ¨ <code>Vue2.x</code>ï¼Œ<code>Vue3.x</code> ä¸­å¯¹æ•°æ®çš„ç›‘å¬æ–¹å¼å·²ç»æ˜¯è€ç”Ÿå¸¸è°ˆäº†ï¼Œä¸å¤–ä¹å°±æ˜¯å¯¹ <code>Object.defineProperty</code> ä»¥åŠ <code>Proxy</code> çš„äº†è§£ã€‚è™½ç„¶èƒ½å¤Ÿåœ¨ MDN ä¸­èƒ½å¤Ÿçœ‹åˆ°ç›¸å…³çš„è¯¦ç»†ä¿¡æ¯ï¼Œä½†æ˜¯æ€»å½’æ„Ÿè§‰æ˜¯è¡Œèµ°åœ¨æµ®å†°ä¹‹ä¸Šã€‚è¿˜æ˜¯å¾—å°†è‡ªå·±çš„ç†è§£æè¿°æˆæ–‡å­—è®°å½•ä¸‹æ¥é è°±ğŸ‘ã€‚</p>
<h2 id="ä½¿ç”¨-Object-defineProperty-å®ç°ç›‘å¬ï¼ˆVue2-xï¼‰"><a href="#ä½¿ç”¨-Object-defineProperty-å®ç°ç›‘å¬ï¼ˆVue2-xï¼‰" class="headerlink" title="ä½¿ç”¨ Object.defineProperty å®ç°ç›‘å¬ï¼ˆVue2.xï¼‰"></a>ä½¿ç”¨ <code>Object.defineProperty</code> å®ç°ç›‘å¬ï¼ˆVue2.xï¼‰</h2><p>å…ˆæ€»ç»“ä¸€ä¸‹ <code>Object.defineProperty</code> çš„ç›‘å¬ç¼ºç‚¹ï¼šæ— æ³•ç›‘å¬å±æ€§çš„æ·»åŠ æˆ–è€…ç§»é™¤ï¼›æ— æ³•ç›‘å¬æ•°ç»„ç´¢å¼•ç›´æ¥èµ‹å€¼ï¼›æ— æ³•ç›‘å¬ä¿®æ”¹æ•°ç»„çš„é•¿åº¦ã€‚</p>
<ul>
<li>ç›‘å¬å¯¹è±¡å±æ€§çš„æ·»åŠ æˆ–è€…ç§»é™¤ï¼š <code>vue</code> æä¾›äº† <code>set</code>ã€<code>delete</code> æ–¹æ³•</li>
<li>ç›‘å¬æ•°ç»„å†…å®¹ã€é•¿åº¦çš„æ›´æ”¹ï¼šä¿®æ”¹æ•°ç»„çš„ç»§æ‰¿å…³ç³»ï¼Œé‡å†™æ–¹æ³•ï¼Œåœ¨é‡å†™æ–¹æ³•å†…éƒ¨è¿›è¡Œæ‹¦æˆªè°ƒç”¨</li>
</ul>
<blockquote>
<p>ä½†æ˜¯ä¸è¦æœ‰ä¸€ç§ <code>Object.defineProperty</code> æ— æ³•ç›‘å¬æ•°ç»„å˜åŒ–çš„è¯¯åŒºã€‚<code>Object.defineProperty</code> å¯ä»¥å¯¹æ•°ç»„åšç›‘å¬ï¼Œåªæ˜¯è¿™ä¹ˆåšä¼šå¯¹æ€§èƒ½æœ‰å¾ˆå¤§å½±å“ï¼š</p>
<ol>
<li>å½“ç»™æ•°ç»„æŸä¸€é¡¹èµ‹å€¼çš„æ—¶å€™ï¼Œä¼šä¾æ¬¡è¯»å–æ•°ç»„çš„æ‰€æœ‰å€¼</li>
<li>æ•°ç»„é•¿åº¦ä¸ç¡®å®šï¼Œæ— æ³•æå‰æ‰“ä¸Š <code>setter/getter</code>ã€‚</li>
</ol>
</blockquote>
<p>åœ¨æ–‡ä»¶å¤¹å†…åˆ›å»ºä¸¤ä¸ªæ–‡ä»¶ï¼š</p>
<figure class="highlight 1c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">æ ¹ç›®å½•</span><br><span class="line">  <span class="string">|- index.html</span></span><br><span class="line">  <span class="string">|- index.js</span></span><br></pre></td></tr></tbody></table></figure>

<p>index.html ä¸­å¯¹ index.js åšå¼•å…¥ï¼Œå¹¶ä¸”åˆ›å»ºæ ‡ç­¾ <code>&lt;h2/&gt;</code></p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span><span class="tag">&lt;/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./index.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></tbody></table></figure>

<p>æ¥ä¸‹æ¥ï¼Œå°±æ˜¯ <code>Object.defineProperty</code> çš„æ“ä½œç§€äº†ã€‚</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="comment">// æ¨¡æ‹Ÿ Vue å®ä¾‹ä¸­ data å±æ€§</span></span><br><span class="line"><span class="keyword">let</span> data = {</span><br><span class="line">    <span class="attr">msg</span>: <span class="string">'hello'</span>,</span><br><span class="line">    <span class="attr">list</span>: []</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡æ‹Ÿ Vue å®ä¾‹ä¸­çš„ vm å¯¹è±¡</span></span><br><span class="line"><span class="keyword">let</span> vm = {}</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(vm, <span class="string">'msg'</span>, {</span><br><span class="line">    <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">    get () {</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'è·å–ç»‘å®šæ•°æ®'</span>, data.msg);</span><br><span class="line">        <span class="keyword">return</span> data.msg</span><br><span class="line">    },</span><br><span class="line">    set (newVal) {</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'æ›´æ–°ç»‘å®šæ•°æ®'</span>, newVal);</span><br><span class="line">        <span class="keyword">if</span> (newVal === data.msg) {</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        data.msg = newVal</span><br><span class="line">        <span class="built_in">document</span>.getElementById(<span class="string">'app'</span>).textContent = newVal</span><br><span class="line">    }</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

<p>è¿™æ ·å­ï¼Œåœ¨ index.html ä¸­ï¼Œ F12 æ‰“å¼€æ§åˆ¶å°ï¼Œè¾“å…¥ <code>vm.msg = 'hello world'</code> å°±èƒ½çœ‹åˆ°æ•ˆæœäº†ã€‚</p>
<p><img src="/posts/1747204526/image_1.png" alt="ç»‘å®šå±æ€§å€¼æ˜¯åŸºæœ¬ç±»å‹"></p>
<p>æ­¤æ—¶ï¼Œæˆ‘ä»¬å°±å¯¹ <code>Object.defineProperty</code> æœ‰äº†ä¸€ä¸ªåŸºæœ¬çš„ä½¿ç”¨äº†ã€‚å½“ <code>data</code> ä¸­æœ‰å¤šä¸ªå±æ€§æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ <code>data</code> çš„å±æ€§åšéå†æ·»åŠ ç›‘å¬å™¨ã€‚</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¨¡æ‹Ÿ Vue å®ä¾‹ä¸­ data å±æ€§</span></span><br><span class="line"><span class="keyword">let</span> data = {</span><br><span class="line">    <span class="attr">msg</span>: <span class="string">'hello'</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">'å¸ƒåˆ©å•¾å•¾ DBLD'</span>,</span><br><span class="line">    <span class="attr">list</span>: [],</span><br><span class="line">    <span class="attr">obj</span>: {</span><br><span class="line">        <span class="attr">msg</span>: <span class="string">'hello'</span></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡æ‹Ÿ Vue å®ä¾‹ä¸­çš„ vm å¯¹è±¡</span></span><br><span class="line"><span class="keyword">let</span> vm = {}</span><br><span class="line"></span><br><span class="line"><span class="comment">// éå†ç›‘å¬ data ä¸­çš„è‡ªèº«å±æ€§ï¼Œä¸ºæ¯ä¸ªå±æ€§æ·»åŠ ç›‘å¬å™¨</span></span><br><span class="line"><span class="built_in">Object</span>.keys(data).forEach(<span class="function"><span class="params">key</span> =&gt;</span> {</span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(vm, key, {</span><br><span class="line">        <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">        get () {</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'è·å–ç»‘å®šæ•°æ®'</span>, data[key]);</span><br><span class="line">            <span class="keyword">return</span> data[key]</span><br><span class="line">        },</span><br><span class="line">        set (newVal) {</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'æ›´æ–°ç»‘å®šæ•°æ®'</span>, newVal);</span><br><span class="line">            <span class="keyword">if</span> (newVal === data[key]) {</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            }</span><br><span class="line">            data[key] = newVal</span><br><span class="line">            <span class="built_in">document</span>.getElementById(<span class="string">'app'</span>).textContent = newVal</span><br><span class="line">        }</span><br><span class="line">    })</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

<p>æˆ‘åœ¨æ§åˆ¶å°è¾“å…¥ <code>vm.obj.msg = 'ä½ å¥½'</code> æ—¶ï¼Œå¹¶ä¸èƒ½ç›‘å¬åˆ°å±æ€§çš„å˜åŒ–ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬åªç›‘å¬äº† <code>obj</code> å±æ€§ï¼Œå´æœªå¯¹å…¶å†…éƒ¨å±æ€§åšç›‘å¬å™¨ã€‚è¿™é‡Œå°±å¾—é€’å½’éå†è¿™ç±»å±æ€§ï¼Œè¿›è¡Œæ·±åº¦ç›‘å¬äº†ï¼Œæ‰€ä»¥éœ€è¦å°†æ·»åŠ ç›‘å¬å™¨çš„è¿‡ç¨‹å°è£…åˆ°å‡½æ•°ä¸­ã€‚</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¨¡æ‹Ÿ Vue å®ä¾‹ä¸­ data å±æ€§</span></span><br><span class="line"><span class="keyword">let</span> data = {</span><br><span class="line">    <span class="attr">msg</span>: <span class="string">'hello'</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">'å¸ƒåˆ©å•¾å•¾ DBLD'</span>,</span><br><span class="line">    <span class="attr">list</span>: [],</span><br><span class="line">    <span class="attr">obj</span>: {</span><br><span class="line">        <span class="attr">msg</span>: <span class="string">'hello'</span></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡æ‹Ÿ Vue å®ä¾‹ä¸­çš„ vm å¯¹è±¡</span></span><br><span class="line"><span class="keyword">let</span> vm = {}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">defineProperty</span> (<span class="params">target, data</span>) </span>{</span><br><span class="line">    <span class="built_in">Object</span>.keys(data).forEach(<span class="function"><span class="params">key</span> =&gt;</span> {</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> data[key] === <span class="string">'object'</span>) {</span><br><span class="line">            <span class="comment">// [object xxx]</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">Object</span>.prototype.toString.call(data[key]).slice(<span class="number">8</span>, -<span class="number">1</span>) === <span class="string">'Object'</span>) {</span><br><span class="line">                target[key] = {}</span><br><span class="line">                defineProperty(target[key], data[key])</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="built_in">Object</span>.defineProperty(target, key, {</span><br><span class="line">                <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">                get () {</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">'è·å–ç»‘å®šæ•°æ®'</span>, data[key]);</span><br><span class="line">                    <span class="keyword">return</span> data[key]</span><br><span class="line">                },</span><br><span class="line">                set (newVal) {</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">'æ›´æ–°ç»‘å®šæ•°æ®'</span>, newVal);</span><br><span class="line">                    <span class="keyword">if</span> (newVal === data[key]) {</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    }</span><br><span class="line">                    data[key] = newVal</span><br><span class="line">                    <span class="built_in">document</span>.getElementById(<span class="string">'app'</span>).textContent = newVal</span><br><span class="line">                }</span><br><span class="line">            })</span><br><span class="line">        }</span><br><span class="line">    })</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">defineProperty(vm, data)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>è¿™æ ·ï¼Œå½“æˆ‘ä»¬æ›´æ”¹æ›´æ·±å±‚æ¬¡å¯¹è±¡çš„æ•°æ®æ—¶ï¼Œä¹Ÿèƒ½å¤Ÿç›‘å¬åˆ°</p>
<p><img src="/posts/1747204526/image_2.png" alt="ç›‘å¬æ›´æ·±å±‚æ¬¡çš„æ•°æ®"></p>
<p>ä»”ç»†çœ‹è¿‡ <code>data</code> å˜é‡ä¸­çš„å±æ€§ï¼Œå°±ä¼šå‘ç°æˆ‘ä»¬ä¸€ç›´æœªå¯¹ <code>list</code> å±æ€§åšæ“ä½œï¼Œå¹¶ä¸æ˜¯å¿˜è®°äº†ã€‚å…·ä½“ç¼˜ç”±ï¼Œå‰å¤´å·²ç»è¯´æ˜ç™½äº†ï¼Œå¯¹äºæ•°ç»„çš„ç›‘å¬ï¼Œé‡‡ç”¨çš„å¹¶ä¸æ˜¯ <code>Object.defineProperty</code> æ–¹æ³•ï¼Œè€Œæ˜¯å¯¹æ•°ç»„çš„ä¸€äº›æ–¹æ³•åšå˜å¼‚æ”¹é€ å¹¶ç›‘å¬ã€‚<br>å› æ­¤ï¼Œå½“åˆ¤æ–­åˆ°å±æ€§çš„å€¼æ˜¯æ•°ç»„æ—¶ï¼Œå°±éœ€è¦å°†è¯¥å±æ€§çš„åŸå‹å¯¹è±¡æŒ‡å‘è¿™ä¸ªå˜å¼‚å¯¹è±¡ï¼Œä»¥å®ç°å¯¹è¯¥å±æ€§å˜åŒ–çš„ç›‘å¬ã€‚</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">defineProperty</span> (<span class="params">target, data</span>) </span>{</span><br><span class="line">    <span class="built_in">Object</span>.keys(data).forEach(<span class="function"><span class="params">key</span> =&gt;</span> {</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> data[key] === <span class="string">'object'</span>) {</span><br><span class="line">            <span class="comment">// [object xxx]</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">Object</span>.prototype.toString.call(data[key]).slice(<span class="number">8</span>, -<span class="number">1</span>) === <span class="string">'Object'</span>) {</span><br><span class="line">                target[key] = {}</span><br><span class="line">                defineProperty(target[key], data[key])</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">Object</span>.prototype.toString.call(data[key]).slice(<span class="number">8</span>, -<span class="number">1</span>) === <span class="string">'Array'</span>) {</span><br><span class="line">                target[key] = []</span><br><span class="line">                <span class="comment">// æ‰‹åŠ¨å°†æ•°ç»„çš„åŸå‹é“¾æŒ‡å‘æ–°çš„åŸå‹å¯¹è±¡</span></span><br><span class="line">                addArrayLisen(target[key])</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="built_in">Object</span>.defineProperty(target, key, {</span><br><span class="line">                <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">                get () {</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">'è·å–ç»‘å®šæ•°æ®'</span>, data[key]);</span><br><span class="line">                    <span class="keyword">return</span> data[key]</span><br><span class="line">                },</span><br><span class="line">                set (newVal) {</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">'æ›´æ–°ç»‘å®šæ•°æ®'</span>, newVal);</span><br><span class="line">                    <span class="keyword">if</span> (newVal === data[key]) {</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    }</span><br><span class="line">                    data[key] = newVal</span><br><span class="line">                    <span class="built_in">document</span>.getElementById(<span class="string">'app'</span>).textContent = newVal</span><br><span class="line">                }</span><br><span class="line">            })</span><br><span class="line">        }</span><br><span class="line">    })</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addArrayLisen</span> (<span class="params">target</span>) </span>{</span><br><span class="line">    <span class="keyword">const</span> oldArrayMethods = <span class="built_in">Array</span>.prototype</span><br><span class="line">    <span class="keyword">const</span> methods = [</span><br><span class="line">        <span class="string">'push'</span>,</span><br><span class="line">        <span class="string">'pop'</span>,</span><br><span class="line">        <span class="string">'unshift'</span>,</span><br><span class="line">        <span class="string">'shift'</span>,</span><br><span class="line">        <span class="string">'splice'</span>,</span><br><span class="line">        <span class="string">'sort'</span>,</span><br><span class="line">        <span class="string">'reverse'</span></span><br><span class="line">    ]</span><br><span class="line">    <span class="keyword">const</span> arrayMethods = <span class="built_in">Object</span>.create({}, oldArrayMethods)</span><br><span class="line">    methods.forEach(<span class="function">(<span class="params">methodKey</span>) =&gt;</span> {</span><br><span class="line">        arrayMethods[methodKey] = <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>{</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">`ç›‘å¬ <span class="subst">${methodKey}</span>`</span>)</span><br><span class="line">            <span class="keyword">const</span> result = oldArrayMethods[methodKey].apply(<span class="built_in">this</span>, args)</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        }</span><br><span class="line">    })</span><br><span class="line">    target.__proto__ = arrayMethods</span><br><span class="line">}</span><br><span class="line">...</span><br></pre></td></tr></tbody></table></figure>

<p>æ­¤æ—¶ï¼Œå½“å¯¹æ•°ç»„å±æ€§æ“ä½œæ—¶ï¼Œå°±èƒ½ç®€å•çš„ç›‘å¬åˆ°å®ƒçš„å˜åŒ–äº†</p>
<p><img src="/posts/1747204526/image_3.png" alt="ç›‘å¬æ•°ç»„å±æ€§å˜åŒ–"></p>
<p>æ•°ç»„å±æ€§å†…éƒ¨ä¸ä½†å¯ä»¥æ·»åŠ åŸºæœ¬ç±»å‹æ•°æ®ä¹Ÿèƒ½å¤Ÿæ·»åŠ  <code>object</code> ç±»å‹æ•°æ®ï¼Œå› æ­¤ï¼Œå½“é€šè¿‡ <code>push</code>ã€<code>unshift</code>ã€<code>splice</code> æ·»åŠ å†…å®¹æ—¶ï¼Œè¿˜éœ€è¦å†å¯¹åŠ å…¥çš„æ•°æ®ä¹Ÿåšæ·±åº¦ç›‘å¬ã€‚</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addArrayLisen</span> (<span class="params">target</span>) </span>{</span><br><span class="line">    <span class="keyword">const</span> oldArrayMethods = <span class="built_in">Array</span>.prototype</span><br><span class="line">    <span class="keyword">const</span> methods = [</span><br><span class="line">        <span class="string">'push'</span>,</span><br><span class="line">        <span class="string">'pop'</span>,</span><br><span class="line">        <span class="string">'unshift'</span>,</span><br><span class="line">        <span class="string">'shift'</span>,</span><br><span class="line">        <span class="string">'splice'</span>,</span><br><span class="line">        <span class="string">'sort'</span>,</span><br><span class="line">        <span class="string">'reverse'</span></span><br><span class="line">    ]</span><br><span class="line">    <span class="keyword">const</span> arrayMethods = <span class="built_in">Object</span>.create({}, oldArrayMethods)</span><br><span class="line">    methods.forEach(<span class="function">(<span class="params">methodKey</span>) =&gt;</span> {</span><br><span class="line">        arrayMethods[methodKey] = <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>{</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">`ç›‘å¬ <span class="subst">${methodKey}</span>`</span>)</span><br><span class="line">            <span class="keyword">const</span> result = oldArrayMethods[methodKey].apply(<span class="built_in">this</span>, args)</span><br><span class="line">            <span class="keyword">switch</span> (methodKey) {</span><br><span class="line">                <span class="keyword">case</span> <span class="string">'push'</span>:</span><br><span class="line">                <span class="keyword">case</span> <span class="string">'unshift'</span>:</span><br><span class="line">                    inserted = args;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">'splice'</span>: <span class="comment">// 3ä¸ª  æ–°å¢çš„å±æ€§ splice æœ‰åˆ é™¤ æ–°å¢çš„çš„åŠŸèƒ½ arr.splice(0,1,{name:1})</span></span><br><span class="line">                    inserted = args.slice(<span class="number">2</span>)</span><br><span class="line">                <span class="attr">default</span>:</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (inserted) defineProperty(target, inserted); <span class="comment">// å°†æ–°å¢å±æ€§ç»§ç»­è§‚æµ‹</span></span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        }</span><br><span class="line">    })</span><br><span class="line">    target.__proto__ = arrayMethods</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>è¿™æ ·å­ï¼Œå½“å†…éƒ¨åŠ å…¥çš„æ˜¯ <code>object</code> ç±»å‹æ—¶ï¼Œä¹Ÿèƒ½å¤Ÿå¯¹å…¶åšåˆ°ç›‘å¬å•¦ã€‚<br>è‡³æ­¤ï¼Œå°±å¯¹ Vue2.x ä¸­ä½¿ç”¨ <code>Object.defineProperty</code> æœ‰äº†ä¸€ä¸ªç®€å•çš„ç†è§£äº†ã€‚</p>
<h2 id="Vue3-x-ä½¿ç”¨çš„-Proxy"><a href="#Vue3-x-ä½¿ç”¨çš„-Proxy" class="headerlink" title="Vue3.x ä½¿ç”¨çš„ Proxy"></a>Vue3.x ä½¿ç”¨çš„ <code>Proxy</code></h2><p>åœ¨å­¦ä¹ ä½¿ç”¨å‰ï¼Œå…ˆçœ‹ä¸€ä¸‹ <code>Proxy</code> çš„å…¼å®¹æ€§ï¼Œç‚¹ <a target="_blank" rel="noopener" href="https://caniuse.com/?search=Proxy">è¿™é‡Œ</a>ï¼Œå¯ä»¥çŸ¥é“ï¼Œ <code>Proxy</code> æœ‰ä¸¥é‡çš„å…¼å®¹æ€§é—®é¢˜ï¼Œå¹¶ä¸”ä¸æ”¯æŒ <code>polyfill</code>ã€‚</p>
<blockquote>
<p>ä¸æ”¯æŒ <code>polyfill</code> çš„åŸå› æ˜¯ <code>Babel</code> çš„ <code>transpiled</code> å’Œ <code>polyfilled</code> éƒ½æ²¡åŠæ³•æ”¯æŒ <code>Proxy</code> çš„åŠŸèƒ½ç‰¹æ€§ã€‚<br>å³: ç”±äº ES5 çš„é™åˆ¶ï¼ŒProxy åŠŸèƒ½ç‰¹æ€§æ— æ³•ç”¨ ES5çš„è¯­æ³•å†™å‡ºæ¥</p>
</blockquote>
<p><code>Proxy</code> ç¿»è¯‘æˆä¸­æ–‡è¿‡æ¥æ˜¯ <em>ä»£ç†</em> çš„æ„æ€ï¼Œé‚£å•¥å«ä»£ç†å‘¢ï¼Ÿå¯ä»¥ç†è§£ä¸ºåœ¨å¯¹è±¡ä¹‹å‰è®¾ç½®ä¸€ä¸ªâ€œæ‹¦æˆªâ€ï¼Œå½“è¯¥å¯¹è±¡è¢«è®¿é—®çš„æ—¶å€™ï¼Œéƒ½å¿…é¡»ç»è¿‡è¿™å±‚æ‹¦æˆªã€‚æ„å‘³ç€ä½ å¯ä»¥åœ¨è¿™å±‚æ‹¦æˆªä¸­è¿›è¡Œå„ç§æ“ä½œã€‚æ¯”å¦‚ä½ å¯ä»¥åœ¨è¿™å±‚æ‹¦æˆªä¸­å¯¹åŸå¯¹è±¡è¿›è¡Œå¤„ç†ï¼Œè¿”å›ä½ æƒ³è¿”å›çš„æ•°æ®ç»“æ„ã€‚</p>
<p>MDNä¸Šçš„è§£é‡Šä¸ºï¼šProxy å¯¹è±¡ç”¨äºå®šä¹‰åŸºæœ¬æ“ä½œçš„è‡ªå®šä¹‰è¡Œä¸ºï¼ˆå¦‚å±æ€§æŸ¥æ‰¾ï¼Œèµ‹å€¼ï¼Œæšä¸¾ï¼Œå‡½æ•°è°ƒç”¨ï¼Œç”šè‡³å¦ä¸€ä¸ªä»£ç†ç­‰ï¼‰ã€‚</p>
<p>æˆ‘ä»¬è¿˜æ˜¯ä¸€æ­¥ä¸€æ­¥çš„æ¥å®ç°ç›‘å¬å§ï¼Œä¸€å£ä¹Ÿåƒä¸æˆä¸€ä¸ªèƒ–å­ï¼</p>
<p>åœ¨ä½¿ç”¨ <code>Proxy</code> å‰ï¼Œå†å¤šæä¸€å˜´ <code>Reflect</code>ï¼Œä¸€èˆ¬ä»–ä¿©æ˜¯é…å¥—ä½¿ç”¨çš„ã€‚</p>
<blockquote>
<p>é‚£ <code>Reflect</code> æ˜¯å•¥å‘¢ï¼Ÿæ¨èç‚¹ <a target="_blank" rel="noopener" href="https://www.zhangxinxu.com/wordpress/2021/07/js-proxy-reflect/">è¿™é‡Œ</a> çœ‹ä¸€ä¸‹ï¼Œæˆ‘è§‰å¾—è®² <code>Reflect</code> æŒºæœ‰è¶£çš„~</p>
</blockquote>
<p>å›å½’æ­£é¢˜ï¼Œè®©æˆ‘ä»¬ç”¨ <code>Proxy</code> æ¥å®ç°å¯¹å¯¹è±¡çš„æ‹¦æˆªå§</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¨¡æ‹Ÿ Vue å®ä¾‹ä¸­ data å±æ€§</span></span><br><span class="line"><span class="keyword">let</span> data = {</span><br><span class="line">    <span class="attr">msg</span>: <span class="string">'hello'</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">'å¸ƒåˆ©å•¾å•¾ DBLD'</span>,</span><br><span class="line">    <span class="attr">list</span>: [],</span><br><span class="line">    <span class="attr">obj</span>: {</span><br><span class="line">        <span class="attr">msg</span>: <span class="string">'hello'</span></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡æ‹Ÿ vm å®ä¾‹å¯¹è±¡</span></span><br><span class="line"><span class="keyword">const</span> vm = <span class="keyword">new</span> <span class="built_in">Proxy</span>(data, {</span><br><span class="line">    set (target, propKey, value) {</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`ç›‘å¬åˆ° <span class="subst">${propKey}</span> çš„å˜åŒ–ï¼Œå€¼æ˜¯ <span class="subst">${value}</span>`</span>)</span><br><span class="line">        <span class="built_in">Reflect</span>.set(target, propKey, value)</span><br><span class="line">    },</span><br><span class="line">    get (target, propKey) {</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`ç›‘å¬åˆ° <span class="subst">${propKey}</span> çš„è·å–ï¼Œå€¼æ˜¯ <span class="subst">${target[propKey]}</span>`</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Reflect</span>.get(target, propKey)</span><br><span class="line">    }</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/posts/1747204526/image_4.png" alt="é‡‡ç”¨ Proxy æ‹¦æˆªå¯¹è±¡"></p>
<p>ä»ä¸Šå›¾ï¼Œèƒ½å¤Ÿçœ‹åˆ°å¯¹åŸºæœ¬ç±»å‹çš„å±æ€§çš„ç›‘å¬æ˜¯å¾ˆç®€å•çš„ï¼Œä½†æ˜¯åƒ <code>list</code>, <code>obj</code> è¿™ç±»ï¼Œæ— æ³•åšåˆ°ç›‘å¬å†…éƒ¨çš„å˜åŒ–ã€‚æ‰€ä»¥ä¾æ—§éœ€è¦å°†è¿›è¡Œå°è£…ã€‚</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¨¡æ‹Ÿ Vue å®ä¾‹ä¸­ data å±æ€§</span></span><br><span class="line"><span class="keyword">let</span> data = {</span><br><span class="line">    <span class="attr">msg</span>: <span class="string">'hello'</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">'å¸ƒåˆ©å•¾å•¾ DBLD'</span>,</span><br><span class="line">    <span class="attr">list</span>: [],</span><br><span class="line">    <span class="attr">obj</span>: {</span><br><span class="line">        <span class="attr">msg</span>: <span class="string">'hello'</span></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡æ‹Ÿ Vue å®ä¾‹ä¸­çš„ vm å¯¹è±¡</span></span><br><span class="line"><span class="keyword">let</span> vm = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reactive</span> (<span class="params">target = {}</span>) </span>{</span><br><span class="line">    <span class="comment">// å¯¹åŸºæœ¬æ•°æ®ç±»å‹åšç›´æ¥è¿”å›ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> target !== <span class="string">'object'</span> || target == <span class="literal">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> target</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> observer = <span class="keyword">new</span> <span class="built_in">Proxy</span>(target, {</span><br><span class="line">        set (target, propKey, value) {</span><br><span class="line">            <span class="comment">// åˆ¤æ–­æ˜¯å¦æ˜¯æ–°å¢å±æ€§</span></span><br><span class="line">            <span class="keyword">const</span> ownKeys = <span class="built_in">Reflect</span>.ownKeys(target)</span><br><span class="line">            <span class="keyword">if</span> (ownKeys.includes(propKey)) {</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'å·²æœ‰çš„ key:'</span>, propKey) <span class="comment">//ç›‘å¬</span></span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'æ–°å¢çš„ key:'</span>, propKey)</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">// é‡å¤çš„æ•°æ®ä¸å¤„ç†</span></span><br><span class="line">            <span class="keyword">const</span> oldVal = target[propKey]</span><br><span class="line">            <span class="keyword">if</span> (value === oldVal) {</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">            }</span><br><span class="line">            <span class="comment">// æ³¨æ„ï¼éœ€è¦å°† set çš„å€¼è¿”å›å‡ºå»ä»¥åšåˆ¤æ–­æ˜¯å¦è®¾ç½®æˆåŠŸ</span></span><br><span class="line">            <span class="keyword">const</span> result = <span class="built_in">Reflect</span>.set(target, propKey, value)</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        },</span><br><span class="line">        get (target, propKey) {</span><br><span class="line">            <span class="comment">// åªç›‘å¬ å¤„ç†æœ¬èº«ï¼ˆéåŸå‹ï¼‰çš„å±æ€§ ,å¦‚ push()</span></span><br><span class="line">            <span class="keyword">const</span> ownKeys = <span class="built_in">Reflect</span>.ownKeys(target)</span><br><span class="line">            <span class="keyword">if</span> (ownKeys.includes(propKey)) {</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'get:'</span>, propKey) <span class="comment">//ç›‘å¬</span></span><br><span class="line">            }</span><br><span class="line">            <span class="comment">// return Reflect.get(target, propKey)</span></span><br><span class="line">            <span class="keyword">const</span> result = <span class="built_in">Reflect</span>.get(target, propKey)</span><br><span class="line">            <span class="keyword">return</span> reactive(result) <span class="comment">//é€’å½’getå¤„ç† å®ç°æ·±åº¦ç›‘å¬</span></span><br><span class="line">        }</span><br><span class="line">    })</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">vm = reactive(data)</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/posts/1747204526/image_5.png" alt="é€šè¿‡ Proxy é€’å½’å±æ€§"></p>
<p>åœ¨ä¸Šå›¾ä¸­ï¼Œå¯ä»¥çœ‹åˆ°é€šè¿‡å¯¹ <code>get</code> æ–¹æ³•å†…å¯¹è·å–åˆ°çš„å€¼åšé€’å½’æ“ä½œï¼Œä¸ç®¡æ˜¯æ–°å¢å±æ€§è¿˜æ˜¯æ—§å±æ€§ï¼Œéƒ½èƒ½å¤Ÿåšç›‘å¬ã€‚ä½†ä¸æ­¢æ˜¯ç›‘å¬æ–°å¢å±æ€§ï¼Œè¿˜èƒ½å¤Ÿé€šè¿‡ <code>handler.deleteProperty</code> æ–¹æ³•ç›‘å¬å¯¹å±æ€§çš„åˆ é™¤æ“ä½œã€‚</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¨¡æ‹Ÿ Vue å®ä¾‹ä¸­ data å±æ€§</span></span><br><span class="line"><span class="keyword">let</span> data = {</span><br><span class="line">    <span class="attr">msg</span>: <span class="string">'hello'</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">'å¸ƒåˆ©å•¾å•¾ DBLD'</span>,</span><br><span class="line">    <span class="attr">list</span>: [],</span><br><span class="line">    <span class="attr">obj</span>: {</span><br><span class="line">        <span class="attr">msg</span>: <span class="string">'hello'</span></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡æ‹Ÿ Vue å®ä¾‹ä¸­çš„ vm å¯¹è±¡</span></span><br><span class="line"><span class="keyword">let</span> vm = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reactive</span> (<span class="params">target = {}</span>) </span>{</span><br><span class="line">    <span class="comment">// å¯¹åŸºæœ¬æ•°æ®ç±»å‹åšç›´æ¥è¿”å›ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> target !== <span class="string">'object'</span> || target == <span class="literal">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> target</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> observer = <span class="keyword">new</span> <span class="built_in">Proxy</span>(target, {</span><br><span class="line">        deleteProperty (target, propKey) {</span><br><span class="line">            <span class="keyword">const</span> result = <span class="built_in">Reflect</span>.deleteProperty(target, key)</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'delete property'</span>, key) <span class="comment">//delete property name</span></span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'result'</span>, result) <span class="comment">//result true</span></span><br><span class="line">            <span class="keyword">return</span> result <span class="comment">//æ˜¯å¦åˆ é™¤æˆåŠŸ</span></span><br><span class="line">        }</span><br><span class="line">    })</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">vm = reactive(data)</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/posts/1747204526/image_6.png" alt="æ‹¦æˆªåˆ é™¤æ“ä½œ"></p>
<h2 id="æ€»ç»“æ¯”è¾ƒ"><a href="#æ€»ç»“æ¯”è¾ƒ" class="headerlink" title="æ€»ç»“æ¯”è¾ƒ"></a>æ€»ç»“æ¯”è¾ƒ</h2><p>vue3.x åŸºäº <code>Proxy</code> å®ç°å“åº”å¼<br>vue2.x åŸºäº <code>Oject.defineProperty</code> å®ç°å“åº”å¼</p>
<p>ç›¸è¾ƒäº <code>Oject.defineProperty</code>ï¼Œ<code>Proxy</code> å®ç°å“åº”å¼ï¼š</p>
<ul>
<li>æ·±åº¦ç›‘å¬ï¼Œæ€§èƒ½æ›´å¥½</li>
<li>å¯ç›‘å¬æ–°å¢åˆ é™¤çš„å±æ€§</li>
<li>å¯ç›‘å¬æ•°ç»„å˜åŒ–</li>
<li>è§„é¿ <code>Object.defineProperty</code> çš„é—®é¢˜</li>
</ul>
<p>ä½†æ˜¯æœ‰å¾—å¿…æœ‰å¤±ï¼š</p>
<ul>
<li><code>Proxy</code> æ— æ³•å…¼å®¹æ‰€æœ‰æµè§ˆå™¨ï¼Œæ— æ³• <code>polyfill</code></li>
</ul>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>BLJJ-DBLD</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="https://bljj-dbld.github.io/posts/1747204526.html">https://bljj-dbld.github.io/posts/1747204526.html</a></span>
                    </p>
                
                
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/%E7%9B%91%E5%90%AC%E5%8E%9F%E7%90%86%E5%AE%9E%E7%8E%B0%E4%B8%8E%E7%90%86%E8%A7%A3/"># ç›‘å¬åŸç†å®ç°ä¸ç†è§£</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>Â· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/posts/45186819.html">P4 æ¥å£ï¼ˆinterfaceï¼‰</a>
            
            
            <a class="next" rel="next" href="/posts/3829252120.html">HTTP + åŠ å¯† + è®¤è¯ + å®Œæ•´æ€§ä¿æŠ¤ = HTTPS</a>
            
        </section>
        <!-- <section class="post-comment">
            <div id="disqus_thread"></div>
        </section> -->

    </article>
</div>

            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>
            Â© 2015-2022 BLJJ-DBLD | Elegant theme by Chic | <a href="https://stats.uptimerobot.com/J8kXJc8qlg" target="_blank">Status</a>
        </span>
    </div>
</footer>

    </div>


<script src="/bundle.js"></script><script>
        // this function is used to check current theme before page loaded.
        (() => {
            const currentTheme = window.localStorage && window.localStorage.getItem('theme') || '';
            const isDark = currentTheme === 'dark';
            const pagebody = document.getElementsByTagName('body')[0]
            if (isDark) {
                pagebody.classList.add('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "Â· Dark"
            } else {
                pagebody.classList.remove('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "Â· Light"
            }
        })();
    ;

    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
;

    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script></body></html>